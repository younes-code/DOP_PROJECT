{% extends 'base.html' %} 
{% load static %} 
{% block title %}Prevision Mensuels{% endblock %} 
{% load humanize %}
{% block Previsionsactivate %}active{% endblock Previsionsactivate %}
{% block content %}
{% if messages %}
{% for message in messages %}
  <div class="alert {{ message.tags }} alert-dismissible shadow fade show" role="alert">
      <button type="button" class="close" data-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">&times;</span>
      </button>
      {{ message | safe }}
  </div>
{% endfor %}
{% endif %}

<div class="div" style="width:1400px;">
    <div style="line-height:700%;">  
        <br>
    </div>
        <h1 class="float-left">Veuillez choisir le format d'exportation : </h1>
        <br>

    <table class="table table-striped table-bordered " style="display: none;"  id="mydatatable" data-filter >
       <div style="width: 300px;" class="float-left mb-2" >
    </div>
       
       
    <thead>
        <tr>
            <th colspan='3'> </th>
            <th colspan='2'>Janvier</th>
            <th colspan='2'>Fevrier</th>
            <th colspan='2'>Mars</th>
            <th colspan='2'>Avril</th>
            <th colspan='2'>Mai</th>
            <th colspan='2'>Juin</th>
            <th colspan='2'>Juiller</th>
            <th colspan='2'>Aout</th>
            <th colspan='2'>Septembre</th>
            <th colspan='2'>Octobre</th>
            <th colspan='2'>Novombre</th>
            <th colspan='2'>Decembre</th>

        </tr>
        <tr style="display: none;">
            <th>Region </th>
            <th>Cpte </th>
            <th>Libellé</th>
            <th>Total</th>
            <th>Don Devise</th>
            <th>Total</th>
            <th>Don Devise</th>
            <th>Total</th>
            <th>Don Devise</th>
            <th>Total</th>
            <th>Don Devise</th>
            <th>Total</th>
            <th>Don Devise</th>
            <th>Total</th>
            <th>Don Devise</th>
            <th>Total</th>
            <th>Don Devise</th>
            <th>Total</th>
            <th>Don Devise</th>
            <th>Total</th>
            <th>Don Devise</th>
            <th>Total</th>
            <th>Don Devise</th>
            <th>Total</th>
            <th>Don Devise</th>
            <th>Total</th>
            <th>Don Devise</th>
            
        </tr>
        <tr >
            <th style="display: none;">id</th>
            <th>Region </th>
            <th>Cpte </th>
            <th>Libellé</th>
            <th>Janvier Total</th>
            <th>Janvier Don Devise</th>
            <th>Fevrier Total</th>
            <th>Fevrier Don Devise</th>
            <th>Mars Total</th>
            <th>Mars Don Devise</th>
            <th>Avril Total</th>
            <th>Avril Don Devise</th>
            <th>Mai Total</th>
            <th>Mai Don Devise</th>
            <th>Juin Total</th>
            <th>Juin Don Devise</th>
            <th>Juiller Total</th>
            <th>Juiller Don Devise</th>
            <th>Aout Total</th>
            <th>Aout Don Devise</th>
            <th>Septembre Total</th>
            <th>Septembre Don Devise</th>
            <th>Octobre Total</th>
            <th>Octobre Don Devise</th>
            <th>Novombre Total</th>
            <th>Novombre Don Devise</th>
            <th>Decembre Total</th>
            <th>Decembre Don Devise</th>
            
        </tr>
 
    </thead>
    <tbody>
        {% for smt in Prevision_stm %}
        <tr name="prof_row">                
            {% for stm1 in Prevision_stm1 %}
                {% if stm1.Stimulation.id == pre.Stimulation and stm1.Mois_prev == 'janvier' %}
                    <td>{{stm1.Stimulation.id}}</td>
                    <td>{{stm1.Stimulation.Perimetre.region}}</td>
                    <td>{{stm1.Stimulation.Compte_Analytique}}</td>
                    <td>{{stm1.Stimulation.stimulation}}</td>
                    <td>{{stm1.Montant_Prevu_Total|floatformat:"0"|intcomma}}</td>
                    <td>{{stm1.Montant_Prevu_Devise|floatformat:"0"|intcomma}}</td>
                    
                {% endif %}
                {% comment %}
                {% if pre1.Project.id == pre.Project and pre1.Mois_prev == 'fevrier' %}
                    <td>{{pre1.Montant_Prevu_Total}}</td>
                    <td>{{pre1.Montant_Prevu_Devise}}</td>
                {% endif %}
                {% endcomment %} 
                {% if stm1.Project.id == pre.Project and stm1.Mois_prev == 'mars' %}
                    <td>{{stm1.Montant_Prevu_Total|floatformat:"0"|intcomma}}</td>
                    <td>{{stm1.Montant_Prevu_Devise|floatformat:"0"|intcomma}}</td>
                {% endif %}
                {% if stm1.Project.id == pre.Project and stm1.Mois_prev == 'avril' %}
                    <td>{{stm1.Montant_Prevu_Total|floatformat:"0"|intcomma}}</td>
                    <td>{{stm1.Montant_Prevu_Devise|floatformat:"0"|intcomma}}</td>
                {% endif %}
                {% if stm1.Project.id == pre.Project and stm1.Mois_prev == 'mai' %}
                    <td>{{stm1.Montant_Prevu_Total|floatformat:"0"|intcomma}}</td>
                    <td>{{stm1.Montant_Prevu_Devise|floatformat:"0"|intcomma}}</td>
                {% endif %}
                {% if stm1.Project.id == pre.Project and stm1.Mois_prev == 'juin' %}
                    <td>{{stm1.Montant_Prevu_Total|floatformat:"0"|intcomma}}</td>
                    <td>{{stm1.Montant_Prevu_Devise|floatformat:"0"|intcomma}}</td>
                {% endif %}
                {% if stm1.Project.id == pre.Project and stm1.Mois_prev == 'juillet' %}
                    <td>{{stm1.Montant_Prevu_Total|floatformat:"0"|intcomma}}</td>
                    <td>{{stm1.Montant_Prevu_Devise|floatformat:"0"|intcomma}}</td>
                {% endif %}
                {% if stm1.Project.id == pre.Project and stm1.Mois_prev == 'fevrier' %}
                    <td>{{stm1.Montant_Prevu_Total|floatformat:"0"|intcomma}}</td>
                    <td>{{stm1.Montant_Prevu_Devise|floatformat:"0"|intcomma}}</td>
                {% endif %}
                {% if stm1.Project.id == pre.Project and stm1.Mois_prev == 'aout' %}
                    <td>{{stm1.Montant_Prevu_Total|floatformat:"0"|intcomma}}</td>
                    <td>{{stm1.Montant_Prevu_Devise|floatformat:"0"|intcomma}}</td>
                {% endif %}
                {% if stm1.Project.id == pre.Project and stm1.Mois_prev == 'septembre' %}
                    <td>{{stm1.Montant_Prevu_Total|floatformat:"0"|intcomma}}</td>
                    <td>{{stm1.Montant_Prevu_Devise|floatformat:"0"|intcomma}}</td>
                {% endif %}
                {% if stm1.Project.id == pre.Project and stm1.Mois_prev == 'octobre' %}
                    <td>{{stm1.Montant_Prevu_Total|floatformat:"0"|intcomma}}</td>
                    <td>{{stm1.Montant_Prevu_Devise|floatformat:"0"|intcomma}}</td>
                {% endif %}
                {% if stm1.Project.id == pre.Project and stm1.Mois_prev == 'novombre' %}
                    <td>{{stm1.Montant_Prevu_Total|floatformat:"0"|intcomma}}</td>
                    <td>{{stm1.Montant_Prevu_Devise|floatformat:"0"|intcomma}}</td>
                {% endif %}
                {% if stm1.Project.id == pre.Project and stm1.Mois_prev == 'decembre' %}
                    <td>{{stm1.Montant_Prevu_Total|floatformat:"0"|intcomma}}</td>
                    <td>{{stm1.Montant_Prevu_Devise|floatformat:"0"|intcomma}}</td>
                {% endif %}
            {% endfor %}
        </tr>
      {% endfor %}

      {% for pre in Prevision %}
            <tr name="prof_row">                
                {% for pre1 in Prevision1 %}       
                    {% if pre1.Project.id == pre.Project and pre1.Mois_prev == 'janvier' %}
                        <td>{{pre1.Project.id}}</td>
                        <td>{{pre1.Project.Perimetre.region}}</td>
                        <td>{{pre1.Project.Compte_Analytique}}</td>
                        <td>{{pre1.Project.Libelles}}</td>
                        <td>{{pre1.Montant_Prevu_Total|floatformat:"0"|intcomma}}</td>
                        <td>{{pre1.Montant_Prevu_Devise|floatformat:"0"|intcomma}}</td>
                        
                    {% endif %}
                    {% comment %}
                    {% if pre1.Project.id == pre.Project and pre1.Mois_prev == 'fevrier' %}
                        <td>{{pre1.Montant_Prevu_Total}}</td>
                        <td>{{pre1.Montant_Prevu_Devise}}</td>
                    {% endif %}
                    {% endcomment %} 
                    {% if pre1.Project.id == pre.Project and pre1.Mois_prev == 'mars' %}
                        <td>{{pre1.Montant_Prevu_Total|floatformat:"0"|intcomma}}</td>
                        <td>{{pre1.Montant_Prevu_Devise|floatformat:"0"|intcomma}}</td>
                    {% endif %}
                    {% if pre1.Project.id == pre.Project and pre1.Mois_prev == 'avril' %}
                        <td>{{pre1.Montant_Prevu_Total|floatformat:"0"|intcomma}}</td>
                        <td>{{pre1.Montant_Prevu_Devise|floatformat:"0"|intcomma}}</td>
                    {% endif %}
                    {% if pre1.Project.id == pre.Project and pre1.Mois_prev == 'mai' %}
                        <td>{{pre1.Montant_Prevu_Total|floatformat:"0"|intcomma}}</td>
                        <td>{{pre1.Montant_Prevu_Devise|floatformat:"0"|intcomma}}</td>
                    {% endif %}
                    {% if pre1.Project.id == pre.Project and pre1.Mois_prev == 'juin' %}
                        <td>{{pre1.Montant_Prevu_Total|floatformat:"0"|intcomma}}</td>
                        <td>{{pre1.Montant_Prevu_Devise|floatformat:"0"|intcomma}}</td>
                    {% endif %}
                    {% if pre1.Project.id == pre.Project and pre1.Mois_prev == 'juillet' %}
                        <td>{{pre1.Montant_Prevu_Total|floatformat:"0"|intcomma}}</td>
                        <td>{{pre1.Montant_Prevu_Devise|floatformat:"0"|intcomma}}</td>
                    {% endif %}
                    {% if pre1.Project.id == pre.Project and pre1.Mois_prev == 'fevrier' %}
                        <td>{{pre1.Montant_Prevu_Total|floatformat:"0"|intcomma}}</td>
                        <td>{{pre1.Montant_Prevu_Devise|floatformat:"0"|intcomma}}</td>
                    {% endif %}
                    {% if pre1.Project.id == pre.Project and pre1.Mois_prev == 'aout' %}
                        <td>{{pre1.Montant_Prevu_Total|floatformat:"0"|intcomma}}</td>
                        <td>{{pre1.Montant_Prevu_Devise|floatformat:"0"|intcomma}}</td>
                    {% endif %}
                    {% if pre1.Project.id == pre.Project and pre1.Mois_prev == 'septembre' %}
                        <td>{{pre1.Montant_Prevu_Total|floatformat:"0"|intcomma}}</td>
                        <td>{{pre1.Montant_Prevu_Devise|floatformat:"0"|intcomma}}</td>
                    {% endif %}
                    {% if pre1.Project.id == pre.Project and pre1.Mois_prev == 'octobre' %}
                        <td>{{pre1.Montant_Prevu_Total|floatformat:"0"|intcomma}}</td>
                        <td>{{pre1.Montant_Prevu_Devise|floatformat:"0"|intcomma}}</td>
                    {% endif %}
                    {% if pre1.Project.id == pre.Project and pre1.Mois_prev == 'novombre' %}
                        <td>{{pre1.Montant_Prevu_Total|floatformat:"0"|intcomma}}</td>
                        <td>{{pre1.Montant_Prevu_Devise|floatformat:"0"|intcomma}}</td>
                    {% endif %}
                    {% if pre1.Project.id == pre.Project and pre1.Mois_prev == 'decembre' %}
                        <td>{{pre1.Montant_Prevu_Total|floatformat:"0"|intcomma}}</td>
                        <td>{{pre1.Montant_Prevu_Devise|floatformat:"0"|intcomma}}</td>
                    {% endif %}
                {% endfor %}
            </tr>
      {% endfor %}
</tbody>


    </table>

</div>




<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

<script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script>
<script>

    function Rechercher_region() {
		  
        var input, filter, table, tr, td, i, txtValue;
        input = document.getElementById("rechercher_p");
        filter = input.value.toUpperCase();
        tr = document.getElementsByName("region_row");
        
        console.log(tr.length)
        for (i = 0; i < tr.length; i++) {
          td = tr[i].getElementsByTagName("td")[5];
          if (td) {
            txtValue = td.textContent || td.innerText;
            if (txtValue.toUpperCase().indexOf(filter) > -1) {
              tr[i].style.display = "";
            } else {
              tr[i].style.display = "none";
            }
          }
        }
      };

    $(document).ready(function () {
        $('#mydatatable').DataTable({
            "paging": false,
            "bInfo": false,
            "bPaginate": false,
            columnDefs: [
            { targets: [0],
            className: "hide_column"
            }
            ],
            order: [[0]],
            dom: 'Bfrtip',
            buttons: [
            {
                extend: 'copyHtml5',
                exportOptions: {
                    columns: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27]

                }
            },
            {
                extend: 'excelHtml5',
                exportOptions: {
                    columns: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27]

                }
            },
            {
                extend: 'csvHtml5',
                exportOptions: {
                    columns: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27]

                }
            },
            'colvis'

            ],


            /*"scrollY": 400,*/
            pageLength: 5,
            "aLengthMenu": [
                [6, 10, 25, 50, -1],
                [6, 10, 25, 50, "Tout"]
            ],
            

            "language": {
                "lengthMenu": "Afficher _MENU_",
                "search": "Recherche",
                "zeroRecords": "aucun projet disponible",
                "info": "Montrant _PAGE_ de _PAGES_ pages",
                "infoEmpty": "aucun projet disponible",
                "infoFiltered": "(filtré a partir de _MAX_ projets)",
                "paginate": {
                    "first": "Premier",
                    "last": "Dernier",
                    "next": "Suivant",
                    "previous": "Précédednt"

                },
            },
        });
    });
</script>
<style>
    body, 
    html {
        margin: 0;
        padding: 0;
        height: 100%;
        background: #fff !important;
    }
    .hide_column {
        display : none;
    },

    .dt-buttons{
        left:50%;
        }

</style>
{% endblock %}